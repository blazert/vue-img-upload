Vue.component("vueImgUploader",{template:'<div class="img-inputer" :class="[themeClass, sizeClass, nhe ? \'nhe\': \'\', ]" ref="box">                            <div class="img-inputer-bg" :style="{backgroundImage: bgImgSrc}"></div>                          <i class="iconfont img-inputer__icon" v-html="iconUnicode"></i>                          <p class="img-inputer__placeholder" v-if="placeholder">{{placeholder}}</p>                          <div class="img-inputer__preview-box" v-if="imgSelected && dataUrl">                            <img :src="dataUrl" class="img-inputer__preview-img" v-show="dataUrl">                          </div>                          <label :for="readonly ? \'\' : inputId" class="img-inputer__label"></label>                          <div class="img-inputer__mask" v-if="dataUrl">                            <p class="img-inputer__file-name">{{fileName}}</p>                            <p class="img-inputer__change" v-if="readonly">{{readonlyTipText}}</p>                            <p class="img-inputer__change" v-else>{{bottomText}}</p>                            </div>                          <div class="uploadProgress" v-show="percent > 0 && progressVisible">                    <div class="uploadProgressBox">                    <svg width="40" height="40" viewbox="0 0 40 40">                          <circle cx="20" cy="20" r="18" stroke-width="4" stroke="#D1D3D7" fill="none"></circle>                          <circle :id="circleElementRef" cx="20" cy="20" r="18" stroke-width="4" stroke="#00A5E0" fill="none" transform="matrix(0,-1,1,0,0,40)" stroke-dasharray="0 152"></circle>                      </svg>                      <span class="progressNumber" :id="progressNumberRef"></span>                  </div>                          </div>                          <template v-if="ieBate_9">                          <form :target="\'uploadIframe\'+inputId" :action="iframeUploadUrl" method="post" enctype="multipart/form-data" :id="\'uploadForm\'+inputId">                          <input ref="inputer" type="file" name="file" :id="inputId" :accept="accept" class="img-inputer__inputer" @change="handleFileChange" />                          </form>                          <iframe :name="\'uploadIframe\'+inputId" style="display:none" @load="loadIframe" :id="\'uploadIframe_\'+inputId"></iframe>                          </template>                          <input ref="inputer" v-else type="file" :name="name" :id="inputId" :accept="accept" class="img-inputer__inputer" @change="handleFileChange" />                          <transition name="vip-fade">                            <div class="img-inputer__err" v-if="errText.length">{{errText}}</div>                          </transition>                      </div>',props:{type:{default:"img",type:String},accept:{default:"image/*,video/*;",type:String},id:{default:"",type:String},onChange:{default:null,type:Function},readonly:{type:Boolean,default:!1},readonlyTipText:{default:"不可更改",type:String},bottomText:{default:"点击图片以修改",type:String},placeholder:{default:"",type:String},value:{default:void 0},icon:{default:"",type:String},customerIcon:{default:"",type:String},maxSize:{default:5120,type:Number},size:{default:"",type:String},imgSrc:{default:"",type:String},nhe:{type:Boolean,default:!1},noMask:{type:Boolean,default:!1},theme:{type:String,default:""},name:{type:String,default:"file"},bgimage:{type:String,default:""},ajaxUrl:{type:String,default:""},iframeUploadUrl:{type:String,default:""}},data:function(){return{inputId:"",file:[],dataUrl:"",fileName:"",errText:"",percent:null,progressVisible:!0,XHR_timeout:12e4,ieBate_9:!1}},computed:{imgSelected:function(){return!!this.dataUrl||!!this.fileName},sizeHumanRead:function(){var e=0;return e=this.maxSize<1024?this.maxSize+"K":(this.maxSize/1024).toFixed(this.maxSize%1024>0?2:0)+"M"},sizeClass:function(){if(this.size)return"img-inputer--"+this.size},themeClass:function(){return"img-inputer--"+this.theme},bgImgSrc:function(){return"url('"+this.bgimage+"')"},ICON:function(){var e="";return e=this.icon?this.icon:"light"===this.theme?"img":"clip"},iconUnicode:function(){var e={img:"&#xe608;",clip:"&#xe626;",camera:"&#xe62a;"};return this.customerIcon||e[this.ICON]},circleElementRef:function(){return"circleElementRef"+this.inputId},progressNumberRef:function(){return"progressNumberRef"+this.inputId},ios:function(){var e=navigator.userAgent.toLowerCase(),t=e.indexOf("iphone")!=-1||e.indexOf("ipad")!=-1;return t}},mounted:function(){this.imgSrc&&(this.dataUrl=this.imgSrc,this.fileName=!0);var e=this;["dragleave","drop","dragenter","dragover"].forEach(function(t){e.preventDefaultEvent(t)}),this.addDropSupport()},created:function(){this.inputId=this.id||this.gengerateID(),this.ieBate()},methods:{ieBate:function(){var e=10,t=!1,i=navigator.userAgent.toLowerCase();t=i.indexOf("msie")>-1&&i.match(/msie ([\d.]+)/)[1]<e,this.ieBate_9=t},preventDefaultEvent:function(e){document.addEventListener(e,function(e){e.preventDefault()},!1)},addDropSupport:function(){var e=this.$refs.box,t=this;e.addEventListener("drop",function(e){if(e.preventDefault(),t.readonly)return!1;t.errText="";var i=e.dataTransfer.files;return 0!==i.length&&(i.length>1?(t.errText="暂不支持多文件",!1):void t.handleFileChange(i))})},gengerateID:function(){var e=Math.random().toString(36).substring(3,8);return document.getElementById(e)?this.gengerateID():e},handleFileChange:function(e){if(this.ieBate_9){var t=document.getElementById("uploadForm"+this.inputId);return t.submit(),!1}"undefined"==typeof e.target?this.file=e[0]:this.file=e.target.files[0],this.errText="";var i=Math.floor(this.file.size/1024);return i>this.maxSize?(this.errText="文件大小不能超过"+this.sizeHumanRead,!1):(this.$emit("input",this.file),this.onChange&&this.onChange(this.file,this.file.name),this.$emit("onChange",this.file,this.file.name),this.imgPreview(this.file),this.fileName=this.file.name,this.ajaxUpload(this.file),void this.resetInput())},ajaxUpload:function(e){var t=new FormData;t.append("file",e);var i=this,r=new XMLHttpRequest;r.timeout=this.XHR_timeout,r.open("POST",i.ajaxUrl,!0),r.upload.onprogress=function(e){if(e=e||event,e.lengthComputable){var t=e.loaded/e.total;if(t>.95)return!1;i.progress(t)}},r.ontimeout=function(e){i.uploadError(),alert("Sorry，Upload the timeout.")},r.onreadystatechange=function(e){if(4===r.readyState&&200===r.status){var t=JSON.parse(r.response);0==t.error_code?(i.$emit("uploadsuccess",t),i.progress(1),setTimeout(function(){i.progressVisible=!1},1e3),i.dataUrl=t.data.url):(i.$emit("uploaderror",t),i.uploadError())}},r.send(t)},uploadError:function(){this.dataUrl=this.imgSrc,this.progressVisible=!1,this.fileName="",this.errText="上传失败"},progress:function(e){var t=2*Math.PI*18;this.percent=e.toFixed(2),document.getElementById(this.circleElementRef).setAttribute("stroke-dasharray",t*e+" "+t*(1-e)),document.getElementById(this.progressNumberRef).innerText=parseInt(100*this.percent)+"%"},imgPreview:function(e){var t=this;if(e&&window.FileReader&&/^image/.test(e.type)){var i=new FileReader;i.readAsDataURL(e),i.onloadend=function(){t.dataUrl=this.result}}},resetInput:function(){var e=document.getElementById(this.inputId),t=document.createElement("form");document.body.appendChild(t);var i,r=e.parentNode,a=r.lastChild===e;a||(i=e.nextSibling),t.appendChild(e),t.reset(),a?r.appendChild(e):r.insertBefore(e,i),document.body.removeChild(t)},loadIframe:function(e){var t=e.target.contentDocument.body.textContent;if(!t)return!1;var i=JSON.parse(t)||{};0!=i.error_code?(this.$emit("uploaderror",i),this.uploadError()):(this.$emit("uploadsuccess",i),this.dataUrl=i.data.url)}},watch:{imgSrc:function(e){this.dataUrl=e,e||(this.file=[],this.errText="",this.fileName="")},value:function(e,t){t&&!e&&(this.file=[],this.dataUrl="",this.errText="",this.fileName="")}}});